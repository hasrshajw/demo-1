<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayrollPro - All Employees</title>
    <style>
          /* --- 1. DESIGN SYSTEM --- */
        :root {
            --font-main: 'Inter', sans-serif;
            --ease-cubic: cubic-bezier(0.4, 0, 0.2, 1);
            --radius-sm: 4px; --radius-md: 8px; --radius-lg: 16px;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-focus-ring: 0 0 0 3px;
        }

        /* [THEME] Light Mode Palette */
        [data-theme="light"] {
            --color-primary: #4f46e5; --color-primary-light: #e0e7ff; --color-primary-dark: #3730a3;
            --color-secondary: #475569; --color-background: #f8fafc;
            --color-surface: #ffffff; --color-text-primary: #1f2937;
            --color-text-secondary: #64748b; --color-border: #e5e7eb;
            --color-success: #16a34a; --color-danger: #dc2626; --color-warning: #f59e0b;
            --color-success-bg: #f0fdf4; --color-danger-bg: #fef2f2; --color-warning-bg: #fffbeb;
            --gradient-half-day: linear-gradient(135deg, var(--color-success) 49.5%, var(--color-danger) 50.5%);
        }

        /* [THEME] Dark Mode Palette */
        [data-theme="dark"] {
            --color-primary: #818cf8; --color-primary-light: rgba(129, 140, 248, 0.16); --color-primary-dark: #a7affb;
            --color-secondary: #94a3b8; --color-background: #0f172a;
            --color-surface: #1e293b; --color-text-primary: #f1f5f9;
            --color-text-secondary: #94a3b8; --color-border: #334155;
            --color-success: #4ade80; --color-danger: #f87171; --color-warning: #facc15;
            --color-success-bg: rgba(74, 222, 128, 0.1); --color-danger-bg: rgba(248, 113, 113, 0.1); --color-warning-bg: rgba(250, 204, 21, 0.1);
        }

        /* --- 2. GLOBAL RESETS & BASE STYLES --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { height: 100%; }
        html { scroll-behavior: smooth; }
        body {
            font-family: var(--font-main); background-color: var(--color-background);
            color: var(--color-text-primary); line-height: 1.5;
            transition: background-color 0.3s var(--ease-cubic), color 0.3s var(--ease-cubic);
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 32px; }
        h1, h2, h3 { font-weight: 600; letter-spacing: -0.025em; }
        h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        h2 { font-size: 1.25rem; color: var(--color-text-primary); margin-bottom: 1.5rem; }
        .view { display: none; }
        .view.active { display: block; animation: fadeIn 0.5s var(--ease-cubic); }
        .icon-sm { width: 16px; height: 16px; } .icon-md { width: 20px; height: 20px; } .icon-lg { width: 24px; height: 24px; }
        .danger-text { color: var(--color-danger) !important; } .success-text { color: var(--color-success) !important; }
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0; }

        /* --- 3. LAYOUT & SHELL --- */
        .app-container { display: none; }
        main { padding-top: 48px; padding-bottom: 48px; }
        .app-header {
            height: 65px;
            background-color: hsla(0, 0%, 100%, 0.8); border-bottom: 1px solid var(--color-border);
            padding: 0 16px; display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 100; backdrop-filter: blur(8px);
            transition: background-color 0.3s, border-color 0.3s;
        }
        [data-theme="dark"] .app-header { background-color: hsla(222, 47%, 11%, 0.8); }

        /* NAVBAR STYLES */
        .nav-left, .nav-right { display: flex; align-items: center; gap: 16px; }
        .nav-menu-btn { display: none; } /* Mobile only */
        .profile-menu { position: relative; }
        #profile-dropdown {
            display: none; position: absolute; top: calc(100% + 12px); right: 0;
            background-color: var(--color-surface); border: 1px solid var(--color-border);
            border-radius: var(--radius-md); box-shadow: var(--shadow-lg);
            width: 180px; padding: 8px; animation: modalOpen 0.2s;
        }
        #profile-dropdown.active { display: block; }
        #profile-dropdown .btn { width: 100%; justify-content: flex-start; }
        #mobile-menu {
            position: fixed; top: 0; left: 0; bottom: 0;
            width: 280px; background-color: var(--color-surface);
            transform: translateX(-100%); transition: transform 0.3s var(--ease-cubic);
            z-index: 1020; padding: 24px; box-shadow: var(--shadow-lg);
        }
        #mobile-menu.active { transform: translateX(0); }
        .mobile-menu-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .mobile-menu-title { font-size: 1.2rem; font-weight: 600; }
        #mobile-menu-overlay {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(15, 23, 42, 0.6); z-index: 1010;
        }
        #mobile-menu-overlay.active { display: block; }
        #mobile-menu-content { display: flex; flex-direction: column; gap: 12px; }
        #mobile-menu-content .btn { width: 100%; justify-content: flex-start; }
        
        /* --- 4. COMPONENT LIBRARY --- */
        /* Buttons */
        .btn { padding: 10px 18px; border: 1px solid transparent; border-radius: var(--radius-md); cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: all 0.2s var(--ease-cubic); display: inline-flex; align-items: center; justify-content: center; gap: 8px; text-decoration: none; }
        .btn:focus-visible { outline: var(--shadow-focus-ring) var(--color-primary-light); }
        .btn:hover:not(:disabled) { transform: translateY(-1px); filter: brightness(1.05); }
        .btn:active:not(:disabled) { transform: translateY(0); filter: brightness(1); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary { background-color: var(--color-primary); color: white; box-shadow: var(--shadow-md); }
        .btn-primary:hover:not(:disabled) { background-color: var(--color-primary-dark); }
        .btn-success { background-color: var(--color-success); color: white; }
        .btn-danger { background-color: var(--color-danger); color: white; }
        .btn-secondary { background-color: var(--color-surface); border-color: var(--color-border); color: var(--color-text-primary); box-shadow: var(--shadow-sm); }
        .btn-secondary:hover:not(:disabled) { border-color: var(--color-primary); color: var(--color-primary); background-color: var(--color-primary-light); }
        .btn-warning { background-color: var(--color-warning); color: #1f2937; }
        .btn-ghost { background-color: transparent; border-color: transparent; color: var(--color-text-secondary); }
        .btn-ghost:hover:not(:disabled) { background-color: var(--color-primary-light); color: var(--color-primary); }
        .btn-icon { background: none; border: none; padding: 10px; border-radius: 50%; cursor: pointer; color: var(--color-text-secondary); transition: all 0.2s; display: flex; align-items: center; justify-content: center; }
        .btn-icon:hover { color: var(--color-text-primary); background-color: var(--color-border); }

        /* Cards */
        .card { background: var(--color-surface); border: 1px solid var(--color-border); border-radius: var(--radius-lg); padding: 24px; margin-bottom: 24px; box-shadow: var(--shadow-sm); transition: box-shadow 0.3s var(--ease-cubic), border-color 0.3s var(--ease-cubic); }
        .section-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }

        /* Forms & Modals */
        .form-group { margin-bottom: 1.25rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--color-text-secondary); font-size: 0.9rem; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 1px solid var(--color-border); border-radius: var(--radius-md); background-color: var(--color-background); transition: all 0.2s; color: var(--color-text-primary); }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--color-primary); box-shadow: var(--shadow-focus-ring) var(--color-primary-light); }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(15, 23, 42, 0.6); backdrop-filter: blur(5px); }
        .modal-content { background-color: var(--color-surface); margin: 5rem auto; padding: 32px; border-radius: var(--radius-lg); width: 90%; max-width: 500px; position: relative; box-shadow: var(--shadow-lg); animation: modalOpen 0.4s var(--ease-cubic); }
        .modal-content .modal-actions { display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem; }
        .close-btn { position: absolute; top: 12px; right: 12px; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: var(--color-text-secondary); background-color: transparent; border-radius: 50%; cursor: pointer; transition: background-color 0.2s, color 0.2s; }
        .close-btn:hover { background-color: var(--color-border); color: var(--color-text-primary); }
        #edit-options-modal-content { display: flex; flex-direction: column; gap: 1rem; }

        /* --- 5. VIEW-SPECIFIC STYLES --- */
        /* Auth & Status Views */
        .full-page-center { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; text-align: center; padding: 2rem; }
        .login-card { max-width: 400px; width: 100%; }
        #google-login-btn { width: 100%; font-size: 1rem; padding: 12px 20px; }
        .status-icon { font-size: 4rem; margin-bottom: 1rem; }
        .status-view-content p { color: var(--color-text-secondary); margin-bottom: 2rem; max-width: 450px; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--color-border); cursor: pointer; }

        /* Admin Approval Section */
        .pending-user { display: flex; justify-content: space-between; align-items: center; padding: 1rem; border-bottom: 1px solid var(--color-border); }
        #admin-approval-list, #unlinked-employees-list { display: flex; flex-direction: column; gap: 0.5rem; }
        .pending-user:last-child { border-bottom: none; }
        .pending-user-info { display: flex; align-items: center; gap: 12px; }
        .pending-user-avatar { width: 40px; height: 40px; border-radius: 50%; }
        .pending-user-name { font-weight: 500; }
        .pending-user-email { font-size: 0.8rem; color: var(--color-text-secondary); }
        .pending-user-actions { display: flex; gap: 8px; }
        
        /* Employee Dashboard */
        .employee-welcome { text-align: center; padding: 2rem 0; }
        .employee-welcome img { width: 80px; height: 80px; border-radius: 50%; margin-bottom: 1rem; border: 3px solid var(--color-primary-light); }

        /* Home View */
        .employee-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 4px; border-bottom: 1px solid var(--color-border); transition: all 0.5s var(--ease-cubic); height: 68px; overflow: hidden; position: relative; }
        .employee-row:first-of-type { border-top: 1px solid var(--color-border); }
        .employee-row.hidden { opacity: 0; height: 0; padding: 0; margin: 0; border: none; }
        .employee-name { font-weight: 500; } .actions { display: flex; gap: 8px; }
        #global-summary-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; text-align: center; margin-top: 1.5rem; }
        .global-stat .value { font-size: 1.75rem; font-weight: 700; line-height: 1.2; }
        .global-stat .label { font-size: 0.8rem; color: var(--color-text-secondary); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 0.25rem; }

        /* Employee Summaries View */
        #employee-summaries { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 24px; }
        .summary-card { cursor: pointer; transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s; }
        .summary-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-md); border-color: var(--color-primary); }
        .summary-card .stat { margin-top: 8px; color: var(--color-text-secondary); font-size: 0.9rem; }
        .summary-card .stat strong { color: var(--color-text-primary); font-weight: 600; }

        /* Detail View & Calendar */
        .detail-view-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 24px; }
        .stat-card { text-align: center; padding: 20px; }
        .stat-card-value { font-size: 2.5rem; font-weight: 700; line-height: 1.2; }
        .stat-card-label { font-size: 0.9rem; color: var(--color-text-secondary); text-transform: uppercase; letter-spacing: 0.05em; }
        .delete-section { margin-top: 2rem; padding: 24px; border: 1px solid var(--color-danger); background-color: var(--color-danger-bg); border-radius: var(--radius-lg); }
        hr.section-divider { border: none; height: 1px; background-color: var(--color-border); margin: 48px 0; }
        .calendar-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; }
        .nav-button { background: none; border: none; padding: 0.5rem; border-radius: 50%; cursor: pointer; transition: background-color 0.2s; display: flex; align-items: center; justify-content: center; color: var(--color-text-secondary); }
        .nav-button:hover { background-color: var(--color-border); color: var(--color-text-primary); }
        .nav-button svg { height: 1.25rem; width: 1.25rem; }
        .month-year-display { font-size: 1.1rem; font-weight: 600; text-align: center; flex-grow: 1; }
        .weekdays-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem; text-align: center; font-size: 0.8rem; color: var(--color-text-secondary); font-weight: 500; margin-bottom: 0.5rem; }
        .days-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.25rem; }
        .day { display: flex; align-items: center; justify-content: center; height: 38px; width: 38px; margin: auto; border-radius: 50%; transition: background-color 0.2s, color 0.2s; box-sizing: border-box; font-size: 0.9rem; }
        .day.prev-month, .day.next-month { color: var(--color-text-secondary); opacity: 0.5; }
        .day.today { box-shadow: 0 0 0 2px var(--color-primary); }
        .day.present { background-color: var(--color-success); color: white; }
        .day.absent { background-color: var(--color-danger); color: white; }
        .day.paid-holiday { background-color: var(--color-warning); color: #1f2937; }
        .day.half-day { background: var(--gradient-half-day); color: white; }
        .calendar-legend { display: flex; flex-wrap: wrap; gap: 16px; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--color-border); }
        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.8rem; }
        .legend-color { width: 12px; height: 12px; border-radius: 50%; }

        /* Payment List & History */
        #payment-list ul { list-style: none; }
        #payment-list li { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--color-border); }
        #payment-list li:last-child { border-bottom: none; }
        .payment-details { flex-grow: 1; }
        .payment-actions { display: flex; gap: 8px; }
        .payment-history-actions { text-align: center; margin-top: 1.5rem; }
        
        /* Delete Modals & Alerts */
        .alert-danger { background-color: var(--color-danger-bg); border-left: 4px solid var(--color-danger); padding: 12px 16px; border-radius: var(--radius-md); margin-bottom: 1rem; color: var(--color-danger); font-size: 0.9rem; }

        /* --- 6. UTILITIES & FEEDBACK --- */
        #loader { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.7); justify-content: center; align-items: center; z-index: 9999; backdrop-filter: blur(4px); }
        .spinner { width: 48px; height: 48px; border: 5px solid var(--color-primary-light); border-bottom-color: var(--color-primary); border-radius: 50%; animation: rotation 1s linear infinite; }
        #toast { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); padding: 15px 25px; border-radius: var(--radius-md); color: white; font-weight: 500; box-shadow: var(--shadow-lg); transition: bottom 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); z-index: 1001; }
        #toast.show { bottom: 30px; }
        #toast.success { background-color: var(--color-primary); }
        #toast.error { background-color: var(--color-danger); }

        /* --- 7. ANIMATIONS & RESPONSIVE --- */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes modalOpen { from { opacity: 0; transform: translateY(-30px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes count-up { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .stat-card-value, .global-stat .value { animation: count-up 0.5s var(--ease-cubic); }

        @media (max-width: 768px) {
            .container { padding: 0 16px; }
            .desktop-only { display: none !important; }
            .nav-menu-btn { display: inline-flex; }
            main { padding-top: 24px; padding-bottom: 24px; }
            .app-header { padding: 0 16px; } h1 { font-size: 1.5rem; } h2 { font-size: 1.1rem; }
            .card { padding: 16px; } .modal-content { padding: 24px; }
            .btn { padding: 10px 14px; font-size: 0.9rem; }
            .section-header { flex-direction: column; align-items: stretch; gap: 12px; }
            .pending-user { flex-direction: column; align-items: flex-start; gap: 1rem; padding: 1rem; }
            .pending-user-actions { width: 100%; display: grid; grid-template-columns: 1fr 1fr; gap: 8px;}
            #unlinked-employees-list .pending-user-actions { grid-template-columns: 1fr; }
            .detail-view-grid { grid-template-columns: 1fr; }
            #global-summary-grid { grid-template-columns: 1fr; gap: 1rem; text-align: left; }
            .global-stat { display: flex; justify-content: space-between; align-items: baseline; border-bottom: 1px solid var(--color-border); padding-bottom: 0.75rem; }
            .global-stat:last-child { border-bottom: none; }
            .global-stat .value { font-size: 1.25rem; } .global-stat .label { margin-top: 0; }
            #attendance-tracker .employee-row { height: auto; flex-direction: column; align-items: stretch; gap: 8px; padding: 12px 4px; }
            #attendance-tracker .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
            #attendance-tracker .btn { font-size: 0.85rem; padding: 8px 10px; }
            #employee-summaries { grid-template-columns: 1fr; gap: 16px; }
            #detail-view-header, #employees-view-header, #add-payment-view-header { flex-direction: row; align-items: center; justify-content: flex-start; }
            #detail-view-header .btn, #employees-view-header .btn, #add-payment-view-header .btn { padding: 6px 12px; font-size: 0.85rem; }
            .stat-card { padding: 16px; } .stat-card-value { font-size: 2rem; } .stat-card-label { font-size: 0.75rem; }
            .day { height: 38px; width: 38px; font-size: 0.8rem; }
            .month-year-display { font-size: 1rem; }
            .nav-button svg { height: 1rem; width: 1rem; }
            .calendar-legend { gap: 12px; } .legend-item { font-size: 0.75rem; gap: 6px; }
            #payment-list li { padding: 12px 0; }
        }

        @media (min-width: 769px) {
            .mobile-only { display: none !important; }
        }
    </style>
</head>
<body>
    <div id="app-container" class="app-container">
        <header id="app-header" class="app-header"></header>
        <main>
            <div class="container" id="main-container">
                <div id="employees-view-header" style="margin-bottom: 16px;">
                    <button id="back-to-dashboard-btn" class="btn btn-secondary">⬅️ Back to Dashboard</button>
                </div>
                <div class="card" style="margin-bottom: 0;">
                    <div class="section-header">
                        <h2>All Employees</h2>
                    </div>
                    <div id="employee-summaries" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 24px;">
                        </div>
                </div>
            </div>
        </main>
    </div>

    <div id="toast"></div>
    <div id="loader"><div class="spinner"></div></div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // --- CONFIG & COMMON FUNCTIONS ---
        // (Firebase config, helpers, etc. required here)
        
        // --- INITIALIZATION & PAGE GUARD ---
        document.addEventListener('DOMContentLoaded', () => {
            // ... Initialize Firebase ...
            listenForAuthStateChanges();
        });

        function listenForAuthStateChanges() {
            onAuthStateChanged(auth, async user => {
                if (user && user.email === ADMIN_EMAIL) {
                    showLoader();
                    // renderHeader(); // Function to render header needed
                    await showEmployeesView();
                    bindEventListeners();
                    hideLoader();
                } else {
                    window.location.href = 'login.html';
                }
            });
        }
        
        // --- PAGE-SPECIFIC LOGIC ---
        async function showEmployeesView() {
            const employeesSnap = await getDocs(collection(db, "employees"));
            const employees = employeesSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            await renderEmployeeSummaries(employees);
        }

        async function renderEmployeeSummaries(employees) {
            const container = document.getElementById('employee-summaries');
            if (!container) return;
            const summariesPromises = employees.map(async (emp) => {
                // ... (Logic to fetch attendance/payments and calculate financials for each employee)
                const { dueAmount, totalEarned } = await calculateFinancialsForEmployee(emp); // This is a placeholder for the real logic
                const dueAmountClass = dueAmount > 0 ? 'danger-text' : 'success-text';
                return `<div class="summary-card card" data-employee-id="${emp.id}"><h3>${emp.name}</h3><div class="stat">Amount Due: <strong class="${dueAmountClass}">₹${dueAmount.toFixed(2)}</strong></div></div>`;
            });
            const summariesHtml = await Promise.all(summariesPromises);
            container.innerHTML = summariesHtml.join('');
        }

        function bindEventListeners() {
            document.getElementById('back-to-dashboard-btn').addEventListener('click', () => {
                window.location.href = 'admin-dashboard.html';
            });

            document.getElementById('employee-summaries').addEventListener('click', (e) => {
                const card = e.target.closest('.summary-card');
                if (card) {
                    const employeeId = card.dataset.employeeId;
                    // In a real MPA, we pass the ID in the URL query string
                    window.location.href = `employee-detail.html?id=${employeeId}`;
                }
            });
             // ... Listeners for header buttons (logout, theme) also needed
        }
        
        // Placeholder for helper functions that would need to be included
        async function calculateFinancialsForEmployee(emp) { return { dueAmount: 0, totalEarned: 0 }; /* Real logic needed */ }
        // ... plus all other common JS functions (showLoader, renderHeader, etc.)
    </script>
</body>
</html>
